function strrep(e,t){return e.replace(/\$\w+\$/gi,function(e){var n=t[e.replace(/\$/g,"")];return typeof n=="undefined"?"":n})}function StateWrap(e){this.state="",this.name=e}function ImageUploader(e,t){this.$parent=t,this.$form=t.find("form"),this.name=e,this.statewrap=new StateWrap(e),this.init();var n=this;this.$parent.on("click",function(){if(n.statewrap.state==="error"||n.statewrap.state==="success")n.statewrap.set("start"),n.$form[0].reset(),n.url=null}),evtctrl.addEventListener(e+":enteringState",function(e){n.$parent.addClass("state-"+e),e==="error"?(n.$form.find(".error-message").text(arguments[1]),n.$form.find(".pic-review").css({"background-image":""})):e==="success"?(n.url=arguments[1],n.$form.find(".pic-review").css({"background-image":"url('"+arguments[1]+"')"})):e==="start"&&(n.url=null)}),evtctrl.addEventListener(e+":leavingState",function(e){n.$parent.removeClass("state-"+e)}),this.statewrap.set("start")}function StepsCoord(e,t,n){this.checkValidity=function(){return!1},this.name=e,this.$parent=t,this.$nextStep=t.find(".js-next-step"),this.statewrap=new StateWrap(e),this.triggerCheck(),$.extend(this,n);var r=this;this.$nextStep.on("click",function(){if(r.$nextStep.is(".btn-disabled"))return;evtctrl.dispatchEvent(e+":nextstep")}),this.$parent.find(".js-prev-step").on("click",function(){evtctrl.dispatchEvent(e+":prevstep")}),n.stableNextStep?this.$nextStep.removeClass("btn-disabled"):evtctrl.addEventListener(e+":enteringState",function(e){e?r.$nextStep.removeClass("btn-disabled"):r.$nextStep.addClass("btn-disabled")})}var $document=$(document),evtctrl=function(){function e(){this.listeners={}}return e.prototype={addEventListener:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},dispatchEvent:function(e){var t=this.listeners[e],n=Array.prototype.slice.call(arguments);n.shift();if(t)for(var r=0,i=t.length;r<i;r++)t[r].apply(this,n)},removeEventListeners:function(e){delete this.listeners[e]}},new e}(),popupInject=function(){var e={},t=document.body.querySelector("#wrap_popup");return function(n){return n in e||(e[n]=function(){var e=document.getElementById("template_"+n).innerHTML,r=document.getElementById("popup_"+n);return r||(r=document.createElement("div"),r.id="popup_"+n,t.appendChild(r)),function(t){var t=t||{};r.innerHTML=strrep(e,t),evtctrl.dispatchEvent(n+":injected",t),popupHandlr.show(n)}}()),e[n]}}(),popupHandlr=function(){var e={},t=$("#wrap_popup"),n=$("#wrap_content"),r=$("#wrap_footer"),i;return e.show=function(r){var s=r;if(!r||!r.toString().length)return!1;var o=$("#popup_"+s);return o.length>0?(this.hideAll(!0),i=s,t.removeClass("dn"),n.addClass("dn"),e.hidden=!1,evtctrl.dispatchEvent(s+":shown"),o.removeClass("dn"),scrollTo(0,0),!0):!1},e.hideAll=function(e){t.addClass("dn").children().addClass("dn"),n.removeClass("dn"),!e&&i&&evtctrl.dispatchEvent(i+":hidden")},$document.on("click",".js-close-popup",function(t){e.hideAll()}),e}();StateWrap.prototype={set:function(e){var t=this.state;if(e!==t){this.state=e,evtctrl.dispatchEvent(this.name+":leavingState",t);var n=Array.prototype.slice.call(arguments);n.unshift(null),n[0]=this.name+":enteringState",n[1]=e,evtctrl.dispatchEvent.apply(evtctrl,n)}}},ImageUploader.prototype.UPLOAD_URL="http://baby.360.cn/celebrity/doPostImage",ImageUploader.prototype.init=function(){return window.File&&window.FormData?function(){var e=this;this.$parent.find("input").on("change",function(){var t=new FormData(e.$form[0]);$.ajax({url:e.UPLOAD_URL,type:"POST",beforeSend:function(){e.statewrap.set("loading")},success:function(t){!t||t.errno!=0||!/\.jpg/i.test(t.url)?e.statewrap.set("error","\u51fa\u9519\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u518d\u6b21\u4e0a\u4f20"):e.statewrap.set("success",t.url)},error:function(t){t.status==413?e.statewrap.set("error","\u56fe\u7247\u592a\u5927\uff0c\u8bf7\u538b\u7f29\u540e\u518d\u4f20"):e.statewrap.set("error","\u51fa\u9519\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u518d\u6b21\u4e0a\u4f20")},data:t,cache:!1,contentType:!1,processData:!1})})}:function(){var e=this;new SWFUpload({upload_url:e.UPLOAD_URL,flash_url:"http://baby.360.cn/resource/module/swfupload/2.5.0/swfupload2.5.fix.swf",file_post_name:"pic",file_size_limit:"4 MB",file_upload_limit:1,assume_success_timeout:30,button_placeholder_id:e.$parent.find(".upload_wrap").attr("id"),button_width:e.$form.width(),button_height:e.$form.height(),file_dialog_complete_handler:function(t){if(t>0)return e.startUpload(),!0},upload_start_handler:function(){e.statewrap.set("loading")},upload_error_handler:function(){e.statewrap.set("error","\u51fa\u9519\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u518d\u6b21\u4e0a\u4f20")},upload_success_handler:function(t,n){try{var n=$.parseJSON(n);!n||n.errno!=0||!/\.jpg/i.test(n.url)?e.statewrap.set("error","\u51fa\u9519\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u518d\u6b21\u4e0a\u4f20"):e.statewrap.set("success",n.url)}catch(r){e.statewrap.set("error","\u51fa\u9519\u4e86\uff0c\u8bf7\u5c1d\u8bd5\u518d\u6b21\u4e0a\u4f20")}}})}}(),StepsCoord.prototype={triggerCheck:function(){this.statewrap.set(this.checkValidity())},setValid:function(){this.statewrap.set(!0)}},function(e){var t={require:"\u8bf7\u586b\u5199%s",nameLength:"%s\u5e94\u4e3a2\uff5e6\u5b57",nameFormat:"\u8bf7\u4e0d\u8981\u5305\u542b\u7279\u6b8a\u7b26\u53f7",detailLength:"\u8bf7\u4fdd\u6301\u5b9d\u8d1d\u7684\u4ecb\u7ecd\u572816\u5b57\u4ee5\u5185",phoneLength:"\u624b\u673a\u53f7\u5e94\u4e3a11\u4f4d",phoneFormat:"\u4e0d\u6b63\u786e\u7684\u624b\u673a\u53f7",id:"\u8eab\u4efd\u8bc1\u53f7\u4e0d\u6b63\u786e",email:"\u9519\u8bef\u7684\u7535\u5b50\u90ae\u7bb1"},n={require:function(){return arguments[0].length>0},nameLength:function(){return arguments[0].length<=6&&arguments[0].length>=2},nameFormat:function(){return/^[\u4e00-\u9fa5 0-9A-Za-z]+$/.test(arguments[0])},detailLength:function(){return arguments[0].length<=16},phoneLength:function(){return arguments[0].length==11},phoneFormat:function(){return/^1\d{10}$/.test(arguments[0])},id:function(){return/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(arguments[0])},email:function(){return/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/.test(arguments[0])}},r=function(e){var r=!0,i=e.data("validates"),s=$.trim(e.val()),o=e.data("name"),u;if(e.is("[type=hidden]"))return!0;e.is(":last-child")?(u=$(document.createElement("span")),e.after(u)):u=e.next(),e.removeClass("error"),u.removeClass("error").text("");if(i)for(var a=0;a<i.length;a++)if(i[a]in n&&!n[i[a]](s)){r=!1,e.addClass("error");var f=t[i[a]].replace("%s",o);u.addClass("error").text(f);break}return r},i=function(e){var t=!0;return e.each(function(n){var i=r(e.eq(n));i||(t=!1)}),t};e.validate=r,e.validateAll=i}(window),$(function(){function s(e){var t=$.extend(i,{});e&&(t.redirect_uri=e);var n="?";for(var r in t)n+=r+"="+encodeURIComponent(t[r])+"&";return"https://open.weixin.qq.com/connect/oauth2/authorize"+n}function o(){if(typeof wx!="undefined"){var e={title:"360\u513f\u7ae5\u536b\u58eb\u5bfb\u627e\u4ee3\u8a00\u4eba\u5566\uff01\u8d85\u591a\u5956\u54c1\u7b49\u4f60\u6765\u62ff\uff01",link:s(),imgUrl:"http://p9.qhimg.com/d/inn/e83d885f/200x200.png"};wx.onMenuShareTimeline(e),wx.onMenuShareAppMessage(e)}}function u(){var e=$("#detailed_popup").data("info");if(typeof wx!="undefined"&&typeof e=="object"){var t={title:"\u6211\u5bb6\u5b9d\u8d1d"+e.nickname+"\u60f3\u6210\u4e3a\u840c\u5b9d\u4e4b\u738b\uff01\u60a8\u80fd\u5e2e\u5e2eTA\u6295\u4e00\u7968\u5417\uff1f",link:s("http://baby.360.cn/celebrity/"+e.id),imgUrl:e.pic1||"http://p9.qhimg.com/d/inn/e83d885f/200x200.png"};wx.onMenuShareTimeline(t),wx.onMenuShareAppMessage(t)}else o()}var e=document.getElementById("wechat_info");try{var t=JSON.parse(e.value)}catch(n){return}if(!t||typeof wx=="undefined")return;var r={appId:t.appId,timestamp:t.timestamp,nonceStr:t.noncestr,signature:t.signature,jsApiList:["hideMenuItems","onMenuShareTimeline","onMenuShareAppMessage"]};wx.config(r);var i={appid:t.appId,redirect_uri:"http://baby.360.cn/celebrity",response_type:"code",scope:"snsapi_base"};evtctrl.addEventListener("detail:injected",u),evtctrl.addEventListener("detail:hidden",o),wx.ready(function(){u()})}),$(function(){function l(e){if(typeof e=="object"){e.headpics="";var t=0;return e.pic1&&(e.headpics+='<div class="img" style="background-image:url('+e.pic1+')"></div>',t++),e.pic2&&(e.headpics+='<div class="img" style="background-image:url('+e.pic2+')"></div>',t++),e.pic3&&(e.headpics+='<div class="img" style="background-image:url('+e.pic3+')"></div>',t++),e.animates="ani-"+t,popupInject("detail")(e),!0}}var e=new ImageUploader("pic1",$("#file_upload_1")),t=$("#file_upload_2"),n=$("#file_upload_3"),r=new ImageUploader("pic2",t),i=new ImageUploader("pic3",n);$document.on("click",".js-more-uploader",function(){t.is(".dn")?t.removeClass("dn"):n.is(".dn")&&(n.removeClass("dn"),this.className="dn")});var s=new StepsCoord("join_start",$("#popup_join_start"),{checkValidity:function(){return!!(e.url||r.url||i.url)}});evtctrl.addEventListener("pic1:enteringState",function(){s.triggerCheck()}),evtctrl.addEventListener("pic2:enteringState",function(){s.triggerCheck()}),evtctrl.addEventListener("pic3:enteringState",function(){s.triggerCheck()}),evtctrl.addEventListener("join_start:nextstep",function(){popupHandlr.show("join_baby")});var o=$("#popup_join_baby"),u=o.find("input,textarea,select"),a=new StepsCoord("join_baby",o,{checkValidity:function(){return validateAll(u)},stableNextStep:!0});o.on("submit",function(e){e.preventDefault()}),o.on("blur","input.error, textarea.error, select.error",function(e){validate($(this))}),evtctrl.addEventListener("join_baby:nextstep",function(){if(!a.checkValidity())return;var t=[];e.url&&t.push(e.url),r.url&&t.push(r.url),i.url&&t.push(i.url),popupInject("join_parent")({pic1:t[0]||"",pic2:t[1]||"",pic3:t[2]||"",nickname:$("#input_nickname").val(),description:$("#input_description").val()})}),evtctrl.addEventListener("join_baby:prevstep",function(){popupHandlr.show("join_start")}),evtctrl.addEventListener("join_parent:injected",function(){var e=$("#popup_join_parent"),t=e.find("form"),n=t.find("input, textarea, select"),r=new StepsCoord("join_parent",e,{checkValidity:function(){return validateAll(this.$parent.find("input, textarea, select"))},stableNextStep:!0});t.on("submit",function(e){e.preventDefault()}),t.on("blur","input.error, textarea.error, select.error",function(e){validate($(this))}),evtctrl.removeEventListeners("join_parent:nextstep"),evtctrl.addEventListener("join_parent:nextstep",function(){$("#submit_info_display").removeClass("error").text("");if(!r.checkValidity())return;evtctrl.dispatchEvent("ajax:final_post",t.serialize())})});var f=function(){$("#img_captcha").prop("src","http://captcha.360.cn/image.php?app=ertongweishi&timestamp="+ +(new Date)),$("#input_captcha").val("")};evtctrl.addEventListener("join_parent:shown",f),$document.on("click",".js-refresh-captcha",f),evtctrl.addEventListener("ajax:final_post",function(e){function t(e){var e=e||"\u62a5\u540d\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u7f51\u7edc\u9519\u8bef\uff0c\u518d\u8bd5\u4e00\u6b21\u5427\u3002";$("#submit_info_display").removeClass("info").addClass("error").text(e),f()}$.ajax({url:"//baby.360.cn/celebrity/doSubmit",type:"POST",data:e,beforeSend:function(){$("#submit_next_step").addClass("loading btn-disabled").text("\u63d0\u4ea4\u4e2d")},success:function(e){!e||e.errno!=0?e&&e.errno>-2&&e.errno<100?t(e.msg):t():popupInject("join_success")({url:"//baby.360.cn/celebrity/"+e.id+"?myself="+e.id})},error:function(e){try{var n=$.parseJSON(e.responseText);if(n.errno>-2&&n.errno<100){t(n.msg);return}}catch(r){}t()},complete:function(e){$("#submit_next_step").removeClass("loading btn-disabled").text("\u4e0b\u4e00\u6b65")}})}),evtctrl.addEventListener("join_parent:prevstep",function(){popupHandlr.show("join_baby")}),$document.on("click",".js-join",function(){popupHandlr.show("join_start")}),$document.on("click",".js-to-list",function(){location="//baby.360.cn/celebrity"});var c=$("#data_specific").html(),h=$("#myself_id").val();try{var p=c;c=JSON.parse(c),c.json=p,c.closeBehavior="js-to-list",c.ismyself=h==c.id?"display:block;":"",l(c)}catch(d){}$document.on("click",".js-vote",function(){var e=$(this).data("info");e.json=JSON.stringify(e),l(e)}),$document.on("click",".js-search",function(){popupHandlr.show("search_wrap")}),$document.on("click",".js-rule",function(){popupHandlr.show("rule")}),$document.on("click",".js-share",function(){$("#share-wrap").removeClass("dn").one("click touchend",function(){$(this).addClass("dn")})}),$document.on("click",".js-gift",function(){popupHandlr.show("gift")})}),$(function(){function e(e){var e=e||"\u8be5\u5b9d\u8d1d\u4e0d\u5b58\u5728\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5b9d\u8d1d\u7f16\u53f7<br>\u5b83\u662f\u5b9d\u8d1d\u9875\u9762\u7684\u201cTP\u201d\u540e\u9762\u7684\u4e00\u4e32\u6570\u5b57";r.addClass("error").html(e)}var t=!1,n=$("#baby_search_submit"),r=$("#baby_search_error_display"),i=$("#baby_search_input");$document.on("submit",".js-search",function(e){e.preventDefault();if(!validate(i))return;evtctrl.dispatchEvent("ajax:querybaby",$(this).serialize())}),evtctrl.addEventListener("ajax:querybaby",function(r){t||$.ajax({url:"//baby.360.cn/celebrity/query",type:"get",data:r,beforeSend:function(){n.addClass("loading btn-disabled")},success:function(t){t.id>0?window.location="//baby.360.cn/celebrity/"+t.id:e()},error:function(t){e()},complete:function(){n.removeClass("loading btn-disabled")}})})}),$(function(){function e(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:+(new Date),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=+(new Date);!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}}var t=document.getElementById("template_list_item").innerHTML,n=1,r=!1,i=document.getElementById("loading_stat"),s=document.getElementById("hottest_headlist"),o=!1;evtctrl.addEventListener("detail:shown",function(){o=!0}),evtctrl.addEventListener("detail:hidden",function(){o=!1}),$(window).on("scroll",e(function(){!o&&document.documentElement.clientHeight>loading_stat.getBoundingClientRect().top&&evtctrl.dispatchEvent("ajax:load_more")},1e3)),evtctrl.addEventListener("ajax:load_more",function(){r||$.ajax({url:"//baby.360.cn/celebrity/hottest",type:"GET",data:"pg="+(1+n),beforeSend:function(){r=!0},success:function(e){if(e.hottest&&e.hottest.length>1){var r="";n++;for(var o=0;o<e.hottest.length;o++)e.hottest[o].info=JSON.stringify(e.hottest[o]),r+=strrep(t,e.hottest[o]);s.insertAdjacentHTML("beforeend",r)}e.hasmore||(i.innerHTML="\u6ca1\u6709\u66f4\u591a\u4e86",evtctrl.removeEventListeners("ajax:load_more"))},complete:function(){r=!1}})})}),window.define&&window.define("js/celebrity.wap",function(){});